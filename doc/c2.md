# C2 : Recursos

A API disponibiliza 6 recursos principais na base de dados (*MariaDB*): Restaurantes, Pratos, Clientes, Ingredientes, Entregas e Pedidos. Cada recurso implementa as operações *CRUD* (*Create*, *Read*, *Update*, *Delete*) através dos métodos *HTTP POST*, *GET*, *PUT* e *DELETE*, seguindo os princípios de uma arquitetura *REST*.

## Restaurantes

Este recurso permite a gestão dos restaurantes do sistema, incluindo informações sobre localização, especialidade e condições de entrega.

**Estrutura do Recurso:**

```json
{
    "id": 38,
    "nome": "Asian Fusion",
    "morada": "Rua de São Pedro, 258",
    "telefone": "289333333",
    "especialidade": "Asiática",
    "tempo_medio_preparacao": 30,
    "taxa_entrega": "2.00",
    "pedido_minimo": "10.00",
    "ativo": 1,
    "created_at": "2025-11-30T20:12:58.000Z",
    "updated_at": "2025-11-30T20:12:58.000Z"
}
```

**Operações *CRUD*:**

- `GET /api/restaurantes` - Lista todos os restaurantes ativos
- `GET /api/restaurantes/{id}` - Obtém um restaurante específico pelo seu *ID*
- `GET /api/restaurantes/{id}/pratos` - Lista todos os pratos disponíveis de um restaurante (relação 1:n)
- `POST /api/restaurantes` - Cria um novo restaurante
- `PUT /api/restaurantes/{id}` - Atualiza as informações de um restaurante existente
- `DELETE /api/restaurantes/{id}` - Remove um restaurante do sistema

**Campos da Tabela:**

| Campo | Tipo | Obrigatório | Descrição |
|-------|------|-------------|-----------|
| `id` | *INT* | Sim (*PK*, *Auto*) | Identificador único do restaurante |
| `nome` | *VARCHAR*(200) | Sim | Nome do restaurante |
| `morada` | *VARCHAR*(300) | Sim | Morada completa do restaurante |
| `telefone` | *VARCHAR*(20) | Não | Número de telefone de contacto |
| `especialidade` | *VARCHAR*(100) | Não | Tipo de cozinha (ex: Italiana, Japonesa, etc.) |
| `tempo_medio_preparacao` | *INT* | Não | Tempo médio de preparação em minutos (padrão: 30) |
| `taxa_entrega` | *DECIMAL*(6,2) | Não | Taxa de entrega em euros (padrão: 0.00) |
| `pedido_minimo` | *DECIMAL*(6,2) | Não | Valor mínimo do pedido em euros (padrão: 0.00) |
| `ativo` | *BOOLEAN* | Não | Indica se o restaurante está ativo (padrão: *TRUE*) |
| `created_at` | *TIMESTAMP* | *Auto* | Data e hora de criação do registo |
| `updated_at` | *TIMESTAMP* | *Auto* | Data e hora da última atualização |

**Filtros *HTTP*:**

- `GET /api/restaurantes?especialidade=Italiana` - Filtra restaurantes por especialidade

## Pratos

Este recurso permite a gestão dos pratos disponíveis nos restaurantes, incluindo informações nutricionais e de disponibilidade.

**Estrutura do Recurso:**

```json
{
    "id": 46,
    "restaurante_id": 10,
    "nome": "Arroz de Marisco",
    "descricao": "Arroz com marisco fresco",
    "preco": "16.00",
    "tempo_preparacao": 20,
    "disponivel": 1,
    "vegetariano": 0,
    "vegan": 0,
    "sem_gluten": 0,
    "created_at": "2025-11-30T20:12:58.000Z",
    "updated_at": "2025-11-30T20:12:58.000Z",
    "restaurante_nome": "Seafood Palace"
}
```

**Operações *CRUD*:**

- `GET /api/pratos` - Lista todos os pratos disponíveis
- `GET /api/pratos/{id}` - Obtém um prato específico pelo seu *ID*
- `GET /api/pratos/{id}/ingredientes` - Lista os ingredientes de um prato (relação m:n)
- `POST /api/pratos` - Cria um novo prato
- `POST /api/pratos/{id}/ingredientes` - Adiciona um ingrediente a um prato (relação m:n)
- `PUT /api/pratos/{id}` - Atualiza as informações de um prato existente
- `DELETE /api/pratos/{id}` - Remove um prato do sistema
- `DELETE /api/pratos/{id}/ingredientes?ingrediente_id={id}` - Remove um ingrediente de um prato

**Campos da Tabela:**

| Campo | Tipo | Obrigatório | Descrição |
|-------|------|-------------|-----------|
| `id` | *INT* | Sim (*PK*, *Auto*) | Identificador único do prato |
| `restaurante_id` | *INT* | Sim (*FK*) | Referência ao restaurante (relação 1:n) |
| `nome` | *VARCHAR*(200) | Sim | Nome do prato |
| `descricao` | *TEXT* | Não | Descrição detalhada do prato |
| `preco` | *DECIMAL*(8,2) | Sim | Preço do prato em euros |
| `tempo_preparacao` | *INT* | Não | Tempo de preparação em minutos (padrão: 20) |
| `disponivel` | *BOOLEAN* | Não | Indica se o prato está disponível (padrão: *TRUE*) |
| `vegetariano` | *BOOLEAN* | Não | Indica se o prato é vegetariano (padrão: *FALSE*) |
| `vegan` | *BOOLEAN* | Não | Indica se o prato é vegano (padrão: *FALSE*) |
| `sem_gluten` | *BOOLEAN* | Não | Indica se o prato não contém glúten (padrão: *FALSE*) |
| `created_at` | *TIMESTAMP* | *Auto* | Data e hora de criação do registo |
| `updated_at` | *TIMESTAMP* | *Auto* | Data e hora da última atualização |

**Filtros *HTTP*:**

- `GET /api/pratos?restaurante_id=1` - Filtra pratos por restaurante
- `GET /api/pratos?vegetariano=true` - Filtra apenas pratos vegetarianos

## Clientes

Este recurso permite a gestão dos clientes do sistema, incluindo informações de contacto e estatísticas de pedidos.

**Estrutura do Recurso:**

```json
{
    "id": 42,
    "nome": "Nuno Guerreiro",
    "email": "nuno.guerreiro@email.pt",
    "telefone": "923456791",
    "ativo": 1,
    "created_at": "2025-11-30T20:12:58.000Z",
    "updated_at": "2025-11-30T20:12:58.000Z",
    "num_pedidos": 1,
    "total_gasto": "19.50"
}
```

**Nota:** Os campos `num_pedidos` e `total_gasto` são calculados dinamicamente através de uma agregação (*JOIN* com a tabela `pedidos`) e não existem na tabela `clientes`.

**Operações *CRUD*:**

- `GET /api/clientes` - Lista todos os clientes com estatísticas agregadas (número de pedidos e total gasto)
- `GET /api/clientes/{id}` - Obtém um cliente específico pelo seu *ID*
- `POST /api/clientes` - Regista um novo cliente no sistema
- `PUT /api/clientes/{id}` - Atualiza as informações de um cliente existente
- `DELETE /api/clientes/{id}` - Remove um cliente do sistema (apenas se não tiver entregas associadas)

**Campos da Tabela:**

| Campo | Tipo | Obrigatório | Descrição |
|-------|------|-------------|-----------|
| `id` | *INT* | Sim (*PK*, *Auto*) | Identificador único do cliente |
| `nome` | *VARCHAR*(200) | Sim | Nome completo do cliente |
| `email` | *VARCHAR*(150) | Sim (Único) | Endereço de *email* do cliente (deve ser único) |
| `telefone` | *VARCHAR*(20) | Sim | Número de telefone de contacto |
| `ativo` | *BOOLEAN* | Não | Indica se a conta do cliente está ativa (padrão: *TRUE*) |
| `created_at` | *TIMESTAMP* | *Auto* | Data e hora de criação do registo |
| `updated_at` | *TIMESTAMP* | *Auto* | Data e hora da última atualização |

**Filtros *HTTP*:**

Este recurso não suporta filtros através de *query parameters*.

## Entregas

Este recurso permite a gestão das entregas do sistema, incluindo o rastreamento do estado de cada entrega.

**Estrutura do Recurso:**

```json
{
    "id": 45,
    "cliente_id": 45,
    "restaurante_id": 5,
    "morada_entrega_id": 45,
    "estado": "entregue",
    "created_at": "2025-11-30T20:12:59.000Z",
    "updated_at": "2025-11-30T20:12:59.000Z"
}
```

**Operações *CRUD*:**

- `GET /api/entregas` - Lista todas as entregas (suporta múltiplos filtros)
- `GET /api/entregas/{id}` - Obtém uma entrega específica pelo seu *ID*
- `POST /api/entregas` - Cria uma nova entrega
- `PUT /api/entregas/{id}` - Atualiza os dados de uma entrega existente
- `DELETE /api/entregas/{id}` - Remove uma entrega do sistema

**Campos da Tabela:**

| Campo | Tipo | Obrigatório | Descrição |
|-------|------|-------------|-----------|
| `id` | *INT* | Sim (*PK*, *Auto*) | Identificador único da entrega |
| `cliente_id` | *INT* | Sim (*FK*) | Referência ao cliente |
| `restaurante_id` | *INT* | Sim (*FK*) | Referência ao restaurante |
| `morada_entrega_id` | *INT* | Sim (*FK*) | Referência à morada de entrega |
| `estado` | *ENUM* | Não | Estado da entrega: `pendente`, `a_caminho`, `entregue`, `cancelada` (padrão: `pendente`) |
| `created_at` | *TIMESTAMP* | *Auto* | Data e hora de criação do registo |
| `updated_at` | *TIMESTAMP* | *Auto* | Data e hora da última atualização |

**Filtros *HTTP*:**

- `GET /api/entregas?estado=pendente` - Filtra entregas por estado
- `GET /api/entregas?cliente_id=1` - Filtra entregas por cliente
- `GET /api/entregas?restaurante_id=5` - Filtra entregas por restaurante
- `GET /api/entregas?morada_entrega_id=10` - Filtra entregas por morada de entrega
- `GET /api/entregas?estado=entregue&cliente_id=1` - Combina múltiplos filtros
   
## Ingredientes

Este recurso permite a gestão dos ingredientes utilizados nos pratos, incluindo informações sobre alergénios.

**Estrutura do Recurso:**

```json
{
    "id": 12,
    "nome": "Abacate",
    "unidade": "g",
    "alergeno": 0,
    "created_at": "2025-11-30T20:12:59.000Z"
}
```

**Operações *CRUD*:**

- `GET /api/ingredientes` - Lista todos os ingredientes (suporta filtro por alergénio)
- `GET /api/ingredientes/{id}` - Obtém um ingrediente específico pelo seu *ID*
- `POST /api/ingredientes` - Cria um novo ingrediente
- `PUT /api/ingredientes/{id}` - Atualiza as informações de um ingrediente existente
- `DELETE /api/ingredientes/{id}` - Remove um ingrediente do sistema

**Campos da Tabela:**

| Campo | Tipo | Obrigatório | Descrição |
|-------|------|-------------|-----------|
| `id` | *INT* | Sim (*PK*, *Auto*) | Identificador único do ingrediente |
| `nome` | *VARCHAR*(100) | Sim (Único) | Nome do ingrediente (deve ser único) |
| `unidade` | *ENUM* | Não | Unidade de medida: `g`, `kg`, `ml`, `l`, `unidade`, `fatia` (padrão: `g`) |
| `alergeno` | *BOOLEAN* | Não | Indica se o ingrediente é um alergénio (padrão: *FALSE*) |
| `created_at` | *TIMESTAMP* | *Auto* | Data e hora de criação do registo |

**Filtros *HTTP*:**

- `GET /api/ingredientes?alergeno=true` - Filtra apenas ingredientes que são alergénios
- `GET /api/ingredientes?alergeno=false` - Filtra apenas ingredientes que não são alergénios

## Pedidos

Este recurso permite a gestão dos pedidos do sistema, incluindo o cálculo automático de totais e a gestão de pratos associados.

**Estrutura do Recurso:**

```json
{
    "id": 1,
    "cliente_id": 1,
    "restaurante_id": 1,
    "morada_entrega_id": 1,
    "codigo_pedido": "FD-20251130-1234",
    "subtotal": "19.00",
    "taxa_entrega": "2.50",
    "total": "21.50",
    "metodo_pagamento": "mbway",
    "estado": "entregue",
    "observacoes": "Sem cebola",
    "data_hora": "2025-11-30T20:12:58.000Z",
    "created_at": "2025-11-30T20:12:58.000Z",
    "updated_at": "2025-11-30T20:12:58.000Z",
    "cliente_nome": "João Silva",
    "restaurante_nome": "Pizzaria Bella Napoli",
    "pratos": [
        {
            "id": 1,
            "pedido_id": 1,
            "prato_id": 1,
            "quantidade": 2,
            "preco_unitario": "8.50",
            "subtotal_item": "17.00",
            "prato_nome": "Pizza Margherita",
            "prato_descricao": "Molho de tomate, mozzarella e manjericão"
        }
    ]
}
```

**Nota:** Os campos `cliente_nome` e `restaurante_nome` são calculados através de *JOINs*. O campo `pratos` é uma relação m:n e contém os pratos associados ao pedido.

**Operações *CRUD*:**

- `GET /api/pedidos` - Lista todos os pedidos (suporta filtro por estado)
- `GET /api/pedidos/{id}` - Obtém um pedido específico pelo seu *ID*, incluindo os pratos associados
- `POST /api/pedidos` - Cria um novo pedido (requer *array* de pratos no *body*)
- `PUT /api/pedidos/{id}` - Atualiza as informações de um pedido existente
- `DELETE /api/pedidos/{id}` - Remove um pedido do sistema

**Campos da Tabela:**

| Campo | Tipo | Obrigatório | Descrição |
|-------|------|-------------|-----------|
| `id` | *INT* | Sim (*PK*, *Auto*) | Identificador único do pedido |
| `cliente_id` | *INT* | Sim (*FK*) | Referência ao cliente |
| `restaurante_id` | *INT* | Sim (*FK*) | Referência ao restaurante |
| `morada_entrega_id` | *INT* | Sim (*FK*) | Referência à morada de entrega |
| `codigo_pedido` | *VARCHAR*(20) | Sim (Único) | Código único do pedido (gerado automaticamente) |
| `subtotal` | *DECIMAL*(10,2) | Sim | Subtotal do pedido (soma dos pratos) em euros |
| `taxa_entrega` | *DECIMAL*(6,2) | Não | Taxa de entrega em euros (padrão: obtida do restaurante) |
| `total` | *DECIMAL*(10,2) | Sim | Total do pedido (subtotal + taxa_entrega) em euros |
| `metodo_pagamento` | *ENUM* | Sim | Método de pagamento: `cartao`, `mbway`, `dinheiro`, `carteira` |
| `estado` | *ENUM* | Não | Estado do pedido: `pendente`, `confirmado`, `a_preparar`, `pronto`, `a_caminho`, `entregue`, `cancelado` (padrão: `pendente`) |
| `observacoes` | *TEXT* | Não | Observações gerais do pedido |
| `data_hora` | *TIMESTAMP* | *Auto* | Data e hora do pedido |
| `created_at` | *TIMESTAMP* | *Auto* | Data e hora de criação do registo |
| `updated_at` | *TIMESTAMP* | *Auto* | Data e hora da última atualização |

**Filtros *HTTP*:**

- `GET /api/pedidos?estado=pendente` - Filtra pedidos por estado
- `GET /api/pedidos?estado=entregue` - Lista apenas pedidos entregues

## Relações entre os Recursos

A *API* implementa diferentes tipos de relações entre os recursos, seguindo os princípios de normalização de bases de dados.

### Relações 1:n (Um-para-Muitos)

Estas relações são implementadas através de chaves estrangeiras (*Foreign Keys*) nas tabelas:

- **restaurantes → pratos**: Um restaurante pode ter múltiplos pratos
  - Implementada através do campo `restaurante_id` na tabela `pratos`
  - Endpoint: `GET /api/restaurantes/{id}/pratos`

- **restaurantes → pedidos**: Um restaurante pode receber múltiplos pedidos
  - Implementada através do campo `restaurante_id` na tabela `pedidos`

- **restaurantes → entregas**: Um restaurante pode fazer múltiplas entregas
  - Implementada através do campo `restaurante_id` na tabela `entregas`

- **clientes → pedidos**: Um cliente pode fazer múltiplos pedidos
  - Implementada através do campo `cliente_id` na tabela `pedidos`

- **clientes → moradas_entrega**: Um cliente pode ter múltiplas moradas de entrega
  - Implementada através do campo `cliente_id` na tabela `moradas_entrega`

- **pratos → pedidos_pratos**: Um prato pode estar em múltiplos pedidos (via tabela intermediária)
  - Implementada através da tabela `pedidos_pratos`

### Relações m:n (Muitos-para-Muitos)

Estas relações são implementadas através de tabelas intermediárias (*junction tables*):

- **pratos ↔ ingredientes**: Um prato pode ter vários ingredientes e um ingrediente pode estar em vários pratos
  - Tabela intermediária: `pratos_ingredientes`
  - Campos: `prato_id`, `ingrediente_id`, `quantidade`, `obrigatorio`
  - Endpoints:
    - `GET /api/pratos/{id}/ingredientes` - Lista ingredientes de um prato
    - `POST /api/pratos/{id}/ingredientes` - Adiciona ingrediente a um prato
    - `DELETE /api/pratos/{id}/ingredientes?ingrediente_id={id}` - Remove ingrediente de um prato

- **pedidos ↔ pratos**: Um pedido pode conter vários pratos e um prato pode estar em vários pedidos
  - Tabela intermediária: `pedidos_pratos`
  - Campos: `pedido_id`, `prato_id`, `quantidade`, `preco_unitario`, `subtotal_item`, `observacoes`
  - A relação é incluída automaticamente ao obter um pedido através de `GET /api/pedidos/{id}`

## Filtros HTTP

A *API* suporta filtros através de *query parameters* (parâmetros de consulta) em vários recursos. Os filtros permitem refinar as consultas e obter apenas os dados relevantes.

### Resumo de Filtros por Recurso

**Restaurantes:**
- `especialidade` - Filtra por tipo de cozinha (ex: `?especialidade=Italiana`)

**Pratos:**
- `restaurante_id` - Filtra pratos de um restaurante específico (ex: `?restaurante_id=1`)
- `vegetariano` - Filtra pratos vegetarianos (ex: `?vegetariano=true`)

**Clientes:**
- Não suporta filtros

**Entregas:**
- `estado` - Filtra por estado da entrega (ex: `?estado=pendente`)
- `cliente_id` - Filtra entregas de um cliente (ex: `?cliente_id=1`)
- `restaurante_id` - Filtra entregas de um restaurante (ex: `?restaurante_id=5`)
- `morada_entrega_id` - Filtra por morada de entrega (ex: `?morada_entrega_id=10`)
- **Múltiplos filtros:** Os filtros podem ser combinados (ex: `?estado=entregue&cliente_id=1`)

**Ingredientes:**
- `alergeno` - Filtra ingredientes alergénios (ex: `?alergeno=true`)

**Pedidos:**
- `estado` - Filtra pedidos por estado (ex: `?estado=pendente`)

### Exemplos de Uso

```bash
# Listar restaurantes italianos
GET /api/restaurantes?especialidade=Italiana

# Listar pratos vegetarianos do restaurante 1
GET /api/pratos?restaurante_id=1&vegetariano=true

# Listar entregas pendentes do cliente 5
GET /api/entregas?estado=pendente&cliente_id=5

# Listar apenas ingredientes alergénios
GET /api/ingredientes?alergeno=true
```

---
[< Previous](c1.md) | [^ Main](../../../) | [Next >](c3.md)
:--- | :---: | ---: 
